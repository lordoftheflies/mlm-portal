<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Polymer Starter Kit">
        <title>FlavonTeam</title>

        <!-- Place favicon.ico in the `app/` directory -->

        <!-- Chrome for Android theme color -->
        <meta name="theme-color" content="#2E3AA1">

        <!-- Web Application Manifest -->
        <link rel="manifest" href="manifest.json">

        <!-- Tile color for Win8 -->
        <meta name="msapplication-TileColor" content="#3372DF">

        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="application-name" content="PSK">
        <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Polymer Starter Kit">
        <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

        <!-- Tile icon for Win8 (144x144) -->
        <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">

        <!-- build:css styles/main.css -->
        <link rel="stylesheet" href="styles/main.css">
        <!-- endbuild-->

        <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
        <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
        <!-- endbuild -->

        <!-- Because this project uses vulcanize this should be your only html import
             in this file. All other imports should go in elements.html -->
        <link rel="import" href="elements/elements.html">

        <!-- For shared styles, shared-styles.html import in elements.html -->
        <style is="custom-style" include="shared-styles"></style>
    </head>

    <body unresolved>
        <!-- build:remove -->
        <span id="browser-sync-binding"></span>
        <!-- endbuild -->

        <template is="i18n-dom-bind" id="app">



            <iron-ajax id="login" on-response="sessionInfoHandler" on-error="sessionInitializationErrorHandler" url="{{backEndUrl}}authentication/session?token={{sessionInfo.token}}" last-response="{{sessionInfo}}" auto></iron-ajax>
            <!--Network AJAX-->
            <iron-ajax id="genocideIronAjax" url="{{backEndUrl}}addressbook/genocide" params="{{genocideRequestParams}}" last-response="{{parents}}"></iron-ajax>
            <iron-ajax id="possibleParentsIronAjax" url="{{backEndUrl}}addressbook/all" last-response="{{possibleParents}}" auto></iron-ajax>
            <iron-ajax id="childrenIronAjax" url="{{backEndUrl}}addressbook/children" params="{{childrenRequestParams}}" last-response="{{data}}"></iron-ajax>
            <iron-ajax id="localesAjax" url="{{backEndUrl}}localization/locales" last-response="{{locales}}" auto></iron-ajax>
            <!--Content AJAX-->
            <iron-ajax id="rootModelAjax" url="{{backEndUrl}}content-management/toc/info" params="{{infoRequestParams}}" handle-as="json" last-response="{{rootModel}}"></iron-ajax>
            <iron-ajax id="parentTocAjax" url="{{backEndUrl}}content-management/toc/path" params="{{tocRequestParams}}" handle-as="json" last-response="{{parentModel}}" on-response="onParentTocResponse" on-error="onParentTocError"></iron-ajax>
            <iron-ajax id="childTocAjax" url="{{backEndUrl}}content-management/toc" params="{{tocRequestParams}}" handle-as="json" on-response="onContentResponse" on-error="onContentError" last-response="{{contentChildrenModel}}"></iron-ajax>
            <!--Mailbox-->
            <iron-ajax id="mailBoxAjax" url="{{backEndUrl}}mailbox/{{sessionInfo.token}}/{{selectedMetaAction}}" last-response="{{mailBoxModel}}"></iron-ajax>
            <!--Profile-->
            <iron-ajax id="profileAjax" url="{{backEndUrl}}addressbook/{{sessionInfo.token}}/profile" 
                       last-response="{{profile}}" auto></iron-ajax>

            <!-- <iron-ajax id="mailBoxAjax" hidden="[[!sessionInfo]]" url="{{backEndUrl}}localization/locales" 
     
                        last-response="{{locales}}" auto></iron-ajax>-->


            <paper-dialog id="loginDialog" modal>
                <h2 id="loginDialogTitle">Sign-in</h2>
                <signin-view api-url="{{backEndUrl}}"></signin-view>
            </paper-dialog>
            <paper-dialog id="registrationDialog" modal>
                <h2 id="logonDialogTitle">Sign-on</h2>
                <signon-view api-url="{{backEndUrl}}" activation-code="{{activationCode}}"></signon-view>
            </paper-dialog>
            <paper-dialog id="forgottenPasswordDialog" modal>
                <h2 id="forgottenPasswordDialogTitle">Ask password reset</h2>
                <password-reset-view api-url="{{backEndUrl}}" model="{{sessionInfo.token}}"></password-reset-view>
            </paper-dialog>

            <paper-drawer-panel id="paperDrawerPanel" responsive-width="840px">
                <!-- Drawer Scroll Header Panel -->
                <paper-scroll-header-panel drawer fixed>

                    <!-- Drawer Toolbar -->
                    <paper-toolbar id="drawerToolbar">

                        <span id="mainMenuTitle" class="menu-name">Menu</span>
                    </paper-toolbar>



                    <!-- Drawer Content -->
                    <paper-menu class="app-menu" attr-for-selected="data-route" selected="[[route]]">
                        <a hidden="[[!sessionInfo.powerUser]]" data-route="share-content" href="{{baseUrl}}share-content">
                            <iron-icon icon="send"></iron-icon>
                            <span id="shareContentMenuTitle">Share content</span>
                        </a>

                        <a hidden="[[!sessionInfo]]" data-route="content-tree" href="{{baseUrl}}content-tree/ROOT">
                            <iron-icon icon="mail"></iron-icon>
                            <span id="contentsMenuTitle">Contents</span>
                        </a>

                        <a hidden="[[!sessionInfo.powerUser]]" data-route="mailbox" href="{{baseUrl}}mailbox">
                            <iron-icon icon="markunread-mailbox"></iron-icon>
                            <span id="mailBoxMenuTitle">Mailbox</span>
                        </a>

                        <a  hidden="[[!sessionInfo.powerUser]]" data-route="network" href="{{baseUrl}}network/[[sessionInfo.token]]">
                            <iron-icon icon="supervisor-account"></iron-icon>
                            <span id="networkMenuTitle">Network</span>
                        </a>

                        <a data-route="about" href="{{baseUrl}}about">
                            <iron-icon icon="info"></iron-icon>
                            <span id="aboutMenuTitle">About</span>
                        </a>
                    </paper-menu>
                </paper-scroll-header-panel>

                <!-- Main Area -->
                <paper-scroll-header-panel main id="headerPanelMain" condenses keep-condensed-header>
                    <!-- Main Toolbar -->
                    <paper-toolbar id="mainToolbar" class="tall">
                        <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>

                        <span class="space"></span>

                        <!-- Application name -->
                        <div class="middle middle-container">
                            <iron-pages attr-for-selected="data-route" selected="{{route}}" class="flex">
                                <div data-route="share-content" class="app-name focus-target" tabindex="-1">
                                    <span id="mainTitle">[[applicationTitle]]</span>
                                    <span>/</span>
                                    <span id="shareContentViewTitleLabel" class="page-title">Share content</span>
                                </div>
                                <div data-route="content-tree" class="app-name focus-target" tabindex="-1">
                                    <span id="mainTitle">[[applicationTitle]]</span>
                                    <span>/</span>
                                    <span id="contentTreeViewTitleLabel" class="page-title">Contents</span>
                                </div>
                                <div data-route="mailbox" class="app-name focus-target" tabindex="-1">
                                    <span id="mainTitle">[[applicationTitle]]</span>
                                    <span>/</span>
                                    <span id="mailBoxViewTitleLabel" class="page-title">Mailbox</span>
                                </div>
                                <div data-route="network" class="app-name focus-target" tabindex="-1">
                                    <span id="mainTitle">[[applicationTitle]]</span>
                                    <span>/</span>
                                    <span id="networkViewTitleLabel" class="page-title">Network</span>
                                </div>
                                <div data-route="about" class="app-name focus-target" tabindex="-1">
                                    <span id="mainTitle">[[applicationTitle]]</span>
                                    <span>/</span>
                                    <span id="aboutViewTitleLabel" class="page-title">About</span>
                                </div>
                                <div data-route="profile" class="app-name focus-target" tabindex="-1">
                                    <span id="mainTitle">[[applicationTitle]]</span>
                                    <span>/</span>
                                    <span id="profileViewTitleLabel" class="page-title">Profile</span>
                                </div>
                            </iron-pages>
                        </div>



                        <!-- Toolbar icons -->
                        <div hidden="[[!sessionInfo]]">
                            <paper-button on-tap="showUserNavigation">
                                <iron-icon icon="account-circle"></iron-icon>
                                <span>{{sessionInfo.userName}}</span>
                            </paper-button>
                            <iron-dropdown id="userNavigation" horizontal-align="right" vertical-align="top">
                                <paper-menu attr-for-selected="data-route" selected="[[route]]" class="dropdown-content">
                                    <a data-route="profile" href="{{baseUrl}}profile">
                                        <iron-icon icon="account-circle"></iron-icon>
                                        <span id="profileMenuTitle">Profile</span>
                                    </a>
                                    <a data-route="signout" href="#" on-tap="onLogout">
                                        <iron-icon icon="markunread-mailbox"></iron-icon>
                                        <span id="logoutButtonLabel">Logout</span>
                                    </a>
                                </paper-menu>
                            </iron-dropdown>
                        </div>

                        <!-- Application sub title -->
                        <div class="bottom bottom-container flex" hidden="[[!admin]]">
                            <iron-pages attr-for-selected="data-route" selected="{{route}}" class="flex">
                                <paper-tabs data-route="share-content"  attr-for-selected="name" selected="{{selectedMetaAction}}" style="width: 100%;" autoselect>
                                    <paper-tab text-id="shareTabLabel" name="share">Share</paper-tab>
                                    <paper-tab text-id="embbeddedContentTabLabel" name="embedded">Embed content</paper-tab>
                                    <paper-tab text-id="assembledContentTabLabel" name="assembled">Assembled content</paper-tab>
                                    <paper-tab text-id="propertiesTabLabel" name="props">Properties</paper-tab>
                                </paper-tabs>
                                <paper-tabs hidden="[[!sessionInfo.powerUser]]" data-route="content-tree"  attr-for-selected="name" selected="{{selectedContentFolder}}" style="width: 100%;" autoselect>
                                    <paper-tab text-id="messagesPagePublicFolderTitle" name="public">Public</paper-tab>
                                    <paper-tab text-id="messagesPageMyContentsFolderTitle" name="drafts">Drafts</paper-tab>
                                    <paper-tab text-id="messagesPagePublishedFolderTitle" name="published">Published</paper-tab>
                                </paper-tabs>
                                <paper-tabs data-route="mailbox"  attr-for-selected="name" selected="{{selectedMailboxFolder}}" style="width: 100%;" autoselect>
                                    <paper-tab text-id="mailBoxPageInboxFolderTitle" name="inbox">Inbox</paper-tab> 
                                    <paper-tab text-id="sentItemsPageInboxFolderTitle" name="outbox">Sent items</paper-tab>
                                </paper-tabs>

                                <div data-route="network"  class="layout end-justified">
                                    <!--<paper-icon-button icon="arrow-upward" on-tap="onNavigateUp"></paper-icon-button>-->
                                    <paper-icon-button icon="add-circle" on-tap="onOpenCreateMember"></paper-icon-button>
                                    <paper-icon-button icon="remove-circle" on-tap="onConfirmRemoveMember"></paper-icon-button>
                                    <paper-icon-button icon="send" on-tap="onSendTo"></paper-icon-button>
                                    <template is="dom-if" if="[[isUser(selectedRole)]]">
                                        <paper-icon-button icon="star" on-tap="onOpenPromoteAdminPrompt"></paper-icon-button>
                                    </template>
                                    <template is="dom-if" if="[[isAdmin(selectedRole)]]">
                                        <paper-icon-button icon="star-border" on-tap="onOpenDemoteAdminPrompt"></paper-icon-button>
                                    </template>

                                    <paper-tabs selected="{{selectedAccount}}" scrollable attr-for-selected="id">
                                        <template is="dom-repeat" items="{{parents}}">
                                            <paper-tab id="[[item.id]]" role="{{item.role}}" href="{{baseUrl}}network/{{item.id}}">
                                                <iron-icon class="end-justified" icon="[[getIcon(item.role)]]"></iron-icon>
                                                <a href="{{baseUrl}}network/{{item.id}}">

                                                    [[item.name]]
                                                </a>
                                            </paper-tab>
                                        </template>
                                    </paper-tabs>
                                </div>

                            </iron-pages>
                        </div>
                    </paper-toolbar>

                    <!-- Main Content -->
                    <div class="content">
                        <iron-pages attr-for-selected="data-route" selected="{{route}}">
                            <section data-route="profile">
                                <!--<paper-material elevation="1">-->
                                <!--<h2 id="profileViewTitleLabel" class="page-title focus-target" tabindex="-1">Profile</h2>-->
                                <profile-view account-id="{{sessionInfo.token}}" api-url="{{backEndUrl}}"
                                              profile="{{profile}}"
                                              locales="{{locales}}"></profile-view>
                                <!--</paper-material>-->
                            </section>

                            <section data-route="share-content">
                                <share-content-view 
                                    class="focus-target" id="scv" 
                                    account-id="{{sessionInfo.token}}" 
                                    api-url="{{backEndUrl}}" 
                                    selected-meta-action="{{selectedMetaAction}}">
                                        
                                    <!--sections="{{contentChildrenModel}}"-->
                                </share-content-view>
                            </section>
                            <section data-route="content-tree">
                                <content-tree-view 
                                    id="contentTree"
                                    class="focus-target"
                                    admin="[[sessionInfo.powerUser]]"
                                    selected-root="[[params.contentId]]" 
                                    base-url="/" 
                                    selected-content-folder="{{selectedContentFolder}}"
                                    info-request-params="{{infoRequestParams}}"
                                    root-model="{{rootModel}}"
                                    parent-model="{{parentModel}}"
                                    toc-request-params="{{tocRequestParams}}"
                                    data="{{contentChildrenModel}}"
                                    api-url="{{backEndUrl}}"></content-tree-view>
                            </section>
                            <section data-route="mailbox">
                                <mailbox-view 
                                    data="{{mailBoxModel}}"
                                    selected-mail-box-folder="{{selectedMailboxFolder}}"
                                    class="focus-target" 
                                    account-id="{{sessionInfo.token}}" 
                                    api-url="{{backEndUrl}}">

                                </mailbox-view>
                            </section>
                            <section data-route="network">
                                <network-view 
                                    id="networkView"
                                    class="focus-target" 
                                    genocide-request-params="{{genocideRequestParams}}"
                                    parents="{{parents}}"
                                    data="{{data}}"
                                    locales="{{locales}}"
                                    possible-parents="{{possibleParents}}"
                                    children-request-params="{{childrenRequestParams}}"

                                    account-id="[[params.memberId]]" 
                                    api-url="{{backEndUrl}}" 
                                    owner-id="{{sessionInfo.token}}">

                                </network-view>
                            </section>

                            <section data-route="about">
                                <paper-material 
                                    class="focus-target" elevation="1">
                                    <about-view></about-view>
                                </paper-material>
                            </section>


                        </iron-pages>
                    </div>
                </paper-scroll-header-panel>
            </paper-drawer-panel>

            <paper-toast id="toast">
                <span id="toastMessageText" class="toast-hide-button" role="button" tabindex="0" onclick="app.$.toast.hide()">Ok</span>
            </paper-toast>

            <!-- Uncomment next block to enable Service Worker support (1/2) -->
            <!--
            <paper-toast id="caching-complete"
                         duration="6000"
                         text="Caching complete! This app will work offline.">
            </paper-toast>
        
            <platinum-sw-register auto-register
                                  clients-claim
                                  skip-waiting
                                  base-uri="bower_components/platinum-sw/bootstrap"
                                  on-service-worker-installed="displayInstalledToast">
              <platinum-sw-cache default-cache-strategy="fastest"
                                 cache-config-file="cache-config.json">
              </platinum-sw-cache>
            </platinum-sw-register>
            -->

        </template>

        <!-- build:js scripts/app.js -->
        <script src="scripts/app.js"></script>
        <!-- endbuild-->
    </body>

</html>
