<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/i18n-behavior/i18n-behavior.html">

<link rel="import" href="../plutonium-witdget-behavior.html">

<dom-module id="share-content-view">
    <template>
        <style include="iron-flex iron-flex-alignment">
            :host {
                display: block;
                /*@apply(--layout-vertical);*/
                /*@apply(--layout-horizontal);*/
                /*@apply(--layout-center);*/
            }


            paper-material {
                background-color: white;
            }

            plutonium-cm-form {
                display: block;
                @apply(--layout-vertical);
            }
            /*            :host paper-material {
                            margin-left: 20px;
                            background-color: white;
                            @apply(--layout-vertical);
                            @apply(--layout-center);
                        }*/

            /*             {
                            @apply(--layout-horizontal);
                            @apply(--layout-flex);
                            @apply(--layout-center);
                        }
            /*            .card-content {
                            @apply(--layout-horizontal);
                            @apply(--layout-flex);
                            @apply(--layout-center);
                        }
                        .section-content {
                            display: inline-block;
                            @apply(--layout-horizontal);
                            @apply(--layout-flex);
                                            @apply(--layout-center);
                        }
                        .section-actions {
                            display: inline-block;
                            @apply(--layout-vertical);
                            @apply(--layout-center);
                        }*/
        </style>

        <iron-ajax 
            id="contactsAjax"
            url="{{apiUrl}}/addressbook/{{accountId}}/contacts" 
            last-response="{{contacts}}" 
            auto></iron-ajax>
        <iron-ajax 
            id="parentCandidatesAjax"
            url="{{apiUrl}}/content-management/candidates" 
            last-response="{{parentCandidates}}" 
            auto></iron-ajax>


        <iron-pages selected="{{selectedMetaAction}}" attr-for-selected="name">

            <paper-card elevation="1" name="share" class="layout vertical">
                <div class="card-content layout horizontal">
                    <div class="flex layout vertical">
                        <plutonium-field-recipient  class="flex"
                                                    id="recipientsFieldInput"
                                                    label="To"
                                                    picker-icon="supervisor-account"
                                                    picker-title="Contacts"
                                                    picker-button-tooltip="Choose contacts."
                                                    clear-icon="clear"
                                                    clear-button-tooltip="Clear recipients input."
                                                    attr-for-selected="id"
                                                    as="item"
                                                    items="[[contacts]]">
                            <template is="dom-repeat" items="[[contacts]]">
                                <paper-item id="[[item.id]]" class="item pad">
                                    <label>[[item.name]]</label>
                                </paper-item>
                            </template>
                        </plutonium-field-recipient>
                        <paper-input id="messageInput" class="bottom title" label="Message" value="{{message}}"></paper-input>
                    </div>
                    <!--<div></div>-->
                    <paper-fab class="end-justified" icon="send" on-tap="onSend" title="Publish content" id="sendMessageFab"></paper-fab>
                </div>

            </paper-card>

            <paper-card elevation="1" name="assembled" class="layout vertical">
                <div class="card-content" style="padding-top: 10px;">
                    <plutonium-cm-form 
                        api-url="{{apiUrl}}"
                        id="pcf"
                        editable
                        contacts="{{contacts}}" 
                        content-model="{{contentModel}}"
                        parent-candidates="{{parentCandidates}}"
                        file-upload-target="{{apiUrl}}/fs/upload"
                        editors="[[editorMap]]">

                    </plutonium-cm-form>
                </div>
            </paper-card>

            <paper-card elevation="1" name="embedded" class="layout vertical">
                <!--                            <paper-radio-group selected="{{contentMode}}" attr-for-selected="name">
                                                <paper-radio-button id="embedContentRadio" name="embedded">Embed content</paper-radio-button>
                                                <paper-radio-button id="assembleRadio" name="assembled">Assemble</paper-radio-button>
                                            </paper-radio-group>-->
                <div class="card-content layout horizontal">
                    <file-upload 
                        id="uploadFileText"
                        drop-text="Drop any PDF file here."
                        error-text="File upload failed."
                        droppable="true" 
                        raised="true" 
                        multi="false" 
                        method="POST"
                        target="{{fileUploadTarget}}">Choose File</file-upload>
                    <div class="flex"></div>
                    <paper-fab class="end-justified" icon="send" on-tap="onSend" title="Publish content" id="sendMessageFab"></paper-fab>
                </div>
            </paper-card>

            <paper-card elevation="1"  name="props" class="layout vertical">
                <div class="card-content layout horizontal">
                    <div class="layout vertical flex">
                        <paper-dropdown-menu 
                            id="parentDdLabel"
                            label="Parent">
                            <!--<paper-menu class="layout flex">-->
                            <paper-listbox id="parentCandidatesList"
                                           class="dropdown-content"
                                           attr-for-selected="{{attrForSelected}}"
                                           items="[[parentCandidates]]"
                                           as="parent"
                                           selected="{{selectedParent}}">
                                <template is="dom-repeat" items="[[parentCandidates]]">

                                    <paper-item id="[[item.id]]" class="item pad">
                                        <label>[[item.title]]</label> 
                                    </paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <!---->

                        <paper-input id="contentTitleInput" class="bottom title" label="Title" value="{{contentModel.title}}"></paper-input>
                    </div>
                    <!--<div class="flex"></div>-->
                    <paper-fab class="end-justified" icon="send" on-tap="onSend" title="Publish content" id="sendMessageFab"></paper-fab>

                </div>
            </paper-card>

        </iron-pages>

        <iron-ajax 
            id="shareAjax"
            handle-as="json"
            content-type="application/json"
            method="POST"
            url="{{apiUrl}}content-management/save" 
            body="{{pageDto}}"></iron-ajax>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'share-content-view',
                behaviors: [
                    PlutoniumBehaviors.WidgetBehavior,
                    BehaviorsStore.I18nBehavior

                ],
                properties: {
                    shareAjaxRequest: {
                    },
                    pageDto: {
                        type: Object,
                        notify: true
                    },
                    sections: {
                        type: Object,
                        notify: true,
                        value: {
                            "sections": [
                            ]
                        }
                    },
                    selectedMetaAction: {
                        type: String,
                        notify: true,
                        value: 'assembled'
                    },
                    editorMap: {
                        type: Object,
                        notify: true,
                        value: {
                            "plutonium-cm-editor-image": "imageEditorDialog",
                            "plutonium-cm-editor-link": "linkEditorDialog",
                            "plutonium-cm-editor-text": "textEditorDialog",
                            "plutonium-cm-editor-video": "videoEditorDialog"
                        }
                    },
                    accountId: {
                        type: String,
                        notify: true
                    },
                    kacsa: {
                        type: Object,
                        notify: true,
                        value: {
                            title: "text title",
                            data: "Ez itt a szöveg <strong>erősen</strong> <i>dőlt</i>.",
                            justification: "start-justified",
                            fontSize: 18
                        }
                    },
                    kacsa4: {
                        type: Object,
                        notify: true,
                        value: {
                            title: "text link",
                            data: "415222f8-2bfb-4cfc-beb8-382c1b7946ec",
                            justification: "start-justified",
                            fontSize: 18
                        }
                    },
                    kacsa2: {
                        type: Object,
                        notify: true,
                        value: {
                            title: "image title",
                            data: "http://ghk.h-cdn.co/assets/16/09/1600x800/landscape-1457107485-gettyimages-512366437.jpg",
                            justification: "center-justified",
                            fontSize: 18,
                            width: 300,
                            height: 300
                        }
                    },
                    kacsa3: {
                        type: Object,
                        notify: true,
                        value: {
                            title: "video title",
                            data: "cQrXUVOny4w",
                            justification: "end-justified",
                            fontSize: 18,
                            width: 700,
                            height: 300
                        }
                    }
                },
                //                listeners: {
                //                    'addSection': 'addSection',
                //                    'embedVideo': 'embedVideo',
                //                    'embedImage': 'embedImage'
                //                }
                //                ,
                observers: [
                    'updateModel(sections)'
                ],
                listeners: {
                    'share': 'onShare',
                    'shareAjax.error': 'onShareError',
                    'shareAjax.response': 'onShareResponse'
                },
                updateModel: function (sections) {
                    this.pageDto = {
                    };
                },
                onShare: function (e, details) {
                    console.log('Save content: ' + JSON.stringify(details));
                    this.pageDto = details.content;
                    this.$.shareAjax.generateRequest();
                },
                onShareError: function () {
                    app.$.toast.text = 'Content sharing failed.';
                    app.$.toast.show();
                },
                onShareResponse: function () {
                    app.$.toast.text = 'New content shared successfully.';
                    app.$.toast.show();
                },
                onDecreaseFontSize: function (e) {
                    console.log('Decrease font size.');
                },
                onInreaseFontSize: function (e) {
                    console.log('Increase font size.');
//                    textEditorDialogAcceptButton
                },
                onAlignLeft: function (e) {
                    console.log('Change align to left.');
                },
                onAlignCenter: function (e) {
                    console.log('Change align to center.');
                },
                onAlignRight: function (e) {
                    console.log('Change align to right.');
                }
            });
        })();
    </script>
</dom-module>
