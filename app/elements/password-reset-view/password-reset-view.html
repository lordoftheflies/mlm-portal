<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">

<!-- Behaviors -->
<link rel="import" href="../plutonium-witdget-behavior.html">
<link rel="import" href="../../bower_components/i18n-behavior/i18n-behavior.html">

<dom-module id="password-reset-view">
    <template>
        <style>
            :host {
                display: block;
            }

            :host .card-actions {
                @apply(--layout-center);
                @apply(--layout-horizontal);
            }
        </style>
        <form id="form"
              is="iron-form" 
              content-type="application/json" 
              verbose 
              method="post" 
              on-response="onSignInResponse"
              on-error="onSignInError" 
              action="{{baseUrl}}authentication/resetpassword"
              handle-as="json">
            <div class="card-content">
                <input type="hidden" name="powerUser" value="{{model.powerUser}}" />
                <input type="hidden" name="userName" value="{{model.userName}}" />
                <input type="hidden" name="preferredLanguage" value="{{model.preferredLanguage}}" />
                <gold-email-input name="email" label="Email address" value="{{model.token}}"></gold-email-input>
            </div>
            <div class="card-actions">
                <paper-button id="passwordResetSignIn" raised  on-tap="onNavigateToSignIn" dialog-dismiss>Sign-in</paper-button>
                <paper-fab id="passwordResetAccept" 
                           icon="arrow-forward" 
                           title="Reset password" 
                           on-tap="onPasswordReset" 
                           dialog-confirm></paper-fab>
            </div>

        </form>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'password-reset-view',
                behaviors: [
                    PlutoniumBehaviors.WidgetBehavior,
                    BehaviorsStore.I18nBehavior
                ],
                properties: {
                    model: {
                        type: Object,
                        notify: true,
                        value: {
                            powerUser: false,
                            token: null,
                            userName: null
                        }
                    }
                },
                listeners: {
                    'form.iron-form-response': 'onPasswordResetResponse',
                    'form.iron-form-error': 'onPasswordResetError'
                },
                onNavigateToSignIn: function () {
                    console.log(this.is + ' navigate to signin-view.');
//                    app.$.forgottenPasswordDialog.close();
                    app.$.loginDialog.open();
                },
                onPasswordReset: function () {
                    console.log(this.is + ' submit password reset.');
                    this.$.form.submit();
                    app.$.loginDialog.open();
                },
                onPasswordResetResponse: function() {
                    app.$.toast.text = 'Password reset successfully.';
                    app.$.toast.show();
                },
                onPasswordResetError: function() {
                    app.$.toast.text = 'Password reset failed.';
                    app.$.toast.show();
                    app.$.forgottenPasswordDialog.open();
                }
            });
        })();
    </script>
</dom-module>
